{"ast":null,"code":"const cheerio = require('cheerio');\nconst axios = require('axios');\nconst {\n  infoScraper\n} = require('./infoScraper');\nexports.parentScraper = (uri, page) => {\n  return new Promise((resolve, reject) => {\n    axios(`${uri}/${page}`).then(response => {\n      const $ = cheerio.load(response.data);\n      const comics = [];\n      $('article').each(function () {\n        let coverPage = $(this).find('img').attr('src');\n        let valid = $(this).find('.post-info').children().remove().end().text();\n        let href = $(this).find('a').attr('href');\n\n        //only include individual comics not the bundles\n        if (valid) {\n          const promise = new Promise((resolve, reject) => {\n            axios(`${href}`).then(response => {\n              const $ = cheerio.load(response.data);\n              const title = $('.post-info').find('h1').text().trim();\n              const description = $('.post-contents').find('p').first().children().remove().end().text().trim();\n              const scrapedInfo = $('.post-contents > p:nth-child(7)').text().split(\"|\").splice(1, 3).join().toString();\n              let downloadLinks = {};\n              $('.aio-pulse').each(function () {\n                const scrapedDownloadTitle = $(this).children('a').attr('title').split(' ').join('').toLocaleUpperCase();\n                const scrapedDownloadLinks = $(this).children('a').attr('href');\n                downloadLinks[scrapedDownloadTitle] = scrapedDownloadLinks;\n              });\n              const information = infoScraper(scrapedInfo);\n              const comic = {\n                title,\n                coverPage,\n                description,\n                information,\n                downloadLinks\n              };\n              resolve(comic);\n            }).catch(err => {\n              if (err) {\n                reject(err);\n              }\n            });\n          });\n          comics.push(promise);\n        }\n      });\n      resolve(Promise.all(comics));\n    }).catch(err => {\n      if (err) {\n        reject(err);\n      }\n    });\n  });\n};","map":{"version":3,"names":["cheerio","require","axios","infoScraper","exports","parentScraper","uri","page","Promise","resolve","reject","then","response","$","load","data","comics","each","coverPage","find","attr","valid","children","remove","end","text","href","promise","title","trim","description","first","scrapedInfo","split","splice","join","toString","downloadLinks","scrapedDownloadTitle","toLocaleUpperCase","scrapedDownloadLinks","information","comic","catch","err","push","all"],"sources":["/home/teo/Documents/buscador-comics/frontend/node_modules/comicbooks-api/functions/parentScraper.js"],"sourcesContent":["const cheerio = require('cheerio');\nconst axios = require('axios');\n\nconst { infoScraper } = require('./infoScraper');\n\nexports.parentScraper = (uri, page) => {\n\n    return new Promise((resolve, reject) => {\n\n        axios(`${uri}/${page}`).then(response => {\n\n            const $ = cheerio.load(response.data);\n            const comics = [];\n\n            $('article').each(\n                function() {\n\n                    let coverPage = $(this).find('img').attr('src');\n                    let valid = $(this).find('.post-info').children().remove().end().text();\n                    let href = $(this).find('a').attr('href');\n\n                    //only include individual comics not the bundles\n                    if(valid) {\n                        const promise = new Promise((resolve, reject) => {\n                            axios(`${href}`).then(response => {\n\n                                const $ = cheerio.load(response.data);\n\n                                const title = $('.post-info').find('h1').text().trim();\n                                const description = $('.post-contents').find('p').first().children().remove().end().text().trim();\n                                const scrapedInfo = $('.post-contents > p:nth-child(7)').text().split(\"|\").splice(1, 3).join().toString();\n\n                                let downloadLinks = {};\n                                $('.aio-pulse').each(function() {\n                                    const scrapedDownloadTitle = $(this).children('a').attr('title').split(' ').join('').toLocaleUpperCase();\n                                    const scrapedDownloadLinks = $(this).children('a').attr('href');\n                                    downloadLinks[ scrapedDownloadTitle ] = scrapedDownloadLinks;\n                                });\n\n                                const information = infoScraper(scrapedInfo);\n\n                                const comic = {\n                                    title, coverPage, description, information, downloadLinks\n                                };\n                                resolve(comic);\n                            }).catch(\n                                err => {\n                                    if(err) { reject(err); }\n                                });\n                        });\n                        comics.push(promise);\n                    }\n                });\n            resolve(Promise.all(comics));\n        }).catch(err => {\n            if(err) { reject(err); }\n        });\n    });\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}